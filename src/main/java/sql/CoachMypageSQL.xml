<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="mo.coachmypage">
  
  <select id="receiveRequestListSQL" parameterType="HashMap" resultType="zipcok.coach.model.RequestFormDTO">

select * from
(select rownum as rnum,aaa.* from
(select a.*,m.mem_name,m.mem_addr,m.mem_birth 
from
zipcok_member m,
(select 
r.* from
request_form r
where
req_receive_id= #{id})a
where
m.mem_id= a.req_mem_id
order by req_date desc)aaa)bbb
where
rnum between #{start} and #{end}


 </select>
 
 <select id="sendRequestListSQL" parameterType="HashMap" resultType="zipcok.coach.model.RequestFormDTO">

select * from
(select rownum as rnum,aaa.* from
(select a.*,m.mem_name,m.mem_addr,m.mem_birth 
from
zipcok_member m,
(select 
r.* from
request_form r
where
req_mem_id= #{id})a
where
m.mem_id= a.req_receive_id
order by req_date desc)aaa)bbb
where
rnum between #{start} and #{end}

 </select>
 
 <delete id="requestDelete">
		delete from
			request_form
		where
			req_idx = #{req_idx}
	</delete>
	
	<update id="requestStatusChange">
	update request_form
	set
	req_status = 'ing'
	where req_idx = #{req_idx}
	</update>
	
	<delete id="DelCmpProfileImg" parameterType="zipcok.coach.model.CoachFileDTO"> 
	delete from member_file
    where
    mfile_mem_id = #{mfile_mem_id}
     and
     mfile_key = '회원프로필'
	</delete>
	
	<insert id="insertCmpProfileImg" parameterType="zipcok.coach.model.CoachFileDTO">
	insert into 
	 member_file
	values(
	member_file_mfile_idx.nextval,
	#{mfile_key},
	#{mfile_mem_id},
	#{mfile_upload},
	#{mfile_size},
	#{mfile_orig},
	#{mfile_path},
	#{mfile_type}
	)
	</insert>
	
	<select id="findFileDTO" resultType="zipcok.coach.model.CoachFileDTO">
	 select * from member_file
	 where 
	 mfile_mem_id = #{id}
	 and
	 mfile_key = '회원프로필'
	</select>
	
	<!-- 홈짐 좋아요 총 수 -->
	 <select id="coachMypageHomeGymLikeListTotalCnt" resultType="Integer">
		select count(*) from
	 	(select rownum as rnum,a.* from
	 	(select * from zipcok_like where like_mem_id=#{mem_id} and like_key='홈짐' order by like_idx desc)a)b
	</select>
	
	 <!-- 홈짐 좋아요 목록 -->
	 <select id="coachMypageHomeGymLikeList"  resultType="zipcok.mypage.model.LikeDTO">
	 	select * from
	 	(select rownum as rnum,a.* from
	 	(select * from zipcok_like where like_mem_id=#{mem_id} and like_key='홈짐' order by like_idx desc)a)b
	 	where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end}
	 </select>	
	 
	 <!-- F&A/고객센터 총 개시글 수 -->
	<select id="coachMypageWriteListTotalCnt" resultType="Integer">
		select count(*) from
	 	(select rownum as rnum,a.* from
	 	(select * from zipcok_bbs where bbs_mem_id=#{mem_id} order by bbs_idx desc)a)b
	</select>
	
	<!-- F&A/고객센터 글목록 -->
	<select id="coachMypageWriteList"  resultType="zipcok.cs.model.CsDTO">
		select * from
		(select rownum as rnum,a.* from
		(select * from zipcok_bbs where bbs_mem_id=#{mem_id} and bbs_key='고객센터' order by bbs_idx desc) a) b
		where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end}
	</select>
	
	<!-- 코치마이페이지 일반프로필 -->
	<select id="coachMypageProfile" parameterType="String" resultType="zipcok.member.model.MemberDTO">
	select * from zipcok_member where mem_id=#{mem_id}
	</select>
	
	<update id="coachMypagePwdUpdate" parameterType="zipcok.member.model.MemberDTO">
		update zipcok_member set mem_pwd=#{mem_pwd} where mem_id=#{mem_id}
	</update>
	
	<update id="coachMypageAddrUpdate" parameterType="zipcok.member.model.MemberDTO">
		update zipcok_member set
			mem_zipcode=#{mem_zipcode},
			mem_addr=#{mem_addr},
			mem_detailaddr=#{mem_detailaddr}
			where mem_id=#{mem_id}
	</update>
	
	<update id="coachMypageEmailUpdate" parameterType="zipcok.member.model.MemberDTO">
		update zipcok_member set mem_email=#{mem_email} where mem_id=#{mem_id}
	</update>
	
	<update id="coachMypagePhoneUpdate" parameterType="zipcok.member.model.MemberDTO">
		update zipcok_member set mem_phone=#{mem_phone} where mem_id=#{mem_id}
	</update>
	
  		<delete id="deleteCategories"  parameterType="HashMap" >
	 delete from
	  coach_category
	  where
	  cate_name= #{cate_name}
	  and
	  cate_mem_id=#{cate_mem_id}
	</delete>
	
	<insert id="insertCategory" parameterType="zipcok.coach.model.CategoryDTO">
	insert into 
	 coach_category
	values(
	coach_category_cate_idx.nextval,
	#{cate_mem_id},
	#{cate_name}
	)
	
	</insert>
		
	<delete id="deleteCurri"  parameterType="zipcok.coach.model.CurriDTO">
	delete from coach_curriculum
	where
	curri_mem_id =#{curri_mem_id}
	and
	curri_catename=#{curri_catename}
	</delete>
	
	<insert id="curriInsert" parameterType="zipcok.coach.model.CurriDTO">
		insert into  coach_curriculum
		values(
			coach_curriculum_curri_idx.nextval,
			#{curri_mem_id},
			#{curri_catename},
			#{curri_order},
			#{curri_name},
			#{curri_content}
		)	
	</insert>
	
	<update id="curriUpdate" parameterType="zipcok.coach.model.CurriDTO">
		update  coach_curriculum
		set
			curri_name =#{curri_name},
			curri_content =#{curri_content}
		where
			curri_mem_id=#{curri_mem_id}
			and
			curri_catename =	#{curri_catename}
			and
			curri_order =#{curri_order}		
	</update>
	
  </mapper>