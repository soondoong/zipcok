<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="zipcok.admin">
  <!-- 코치 정보 관리 시작-->
  	<select id="cTotalCnt" parameterType="HashMap" resultType="Integer">
  	select count(*) from
    zipcok_member
  	where
     <choose>
	    <when test="choice=='전체'"></when>
	  	<when test="choice=='번호'">mem_idx = #{searchText}and mem_gender=#{mem_gender} and</when>
	  	<when test="choice=='id'">mem_id=#{searchText}and mem_gender=#{mem_gender} and</when>
	  	<when test="choice=='이름'">mem_name=#{searchText}and mem_gender=#{mem_gender} and</when>
     </choose>
     mem_type='코치회원'
  	</select>
  
  
  
  	<select id="adminSearchCoach" parameterType="HashMap" resultType="zipcok.member.model.MemberAllDTO">	    
  	select * from
    (select rownum as rnum,a.* from
    (select * from zipcok_member
     where
  	<choose>
	  	<when test="choice=='전체'"></when>
	  	<when test="choice=='번호'">
		  	<choose>
		  		<when test="searchText==''">mem_idx<![CDATA[>]]>0 and</when>
		  		<when test="searchText!=''">mem_idx = #{searchText} and</when>
		  	</choose>
	  	</when>
	  	<when test="choice=='id'">
	  		<choose>
		  		<when test="searchText==''">mem_id like '%%' and</when>
		  		<when test="searchText!=''">mem_id=#{searchText} and</when>
		  	</choose>
  		</when>
	  	<when test="choice=='이름'">
	  		<choose>
		  		<when test="searchText==''">mem_name like '%%' and</when>
		  		<when test="searchText!=''">mem_name=#{searchText} and</when>
		  	</choose>
	  	</when>
  	</choose>
  	 
  	<choose>
	  	<when test="mem_gender==''">mem_gender like '%%' and</when>
	  	<when test="mem_gender!=''">mem_gender=#{mem_gender} and</when>
  	</choose>
	  	mem_type='코치회원'
	  	order by mem_idx
	  	)a)b
	  	where
	  	rnum between #{start} and #{end}
  	</select>
  	
  	<select id="adminCoachProfile" parameterType="String" resultType="zipcok.coach.model.CoachDTO">
  		select * from 
  		coach_regist
  		where
  		coach_mem_id = #{coach_mem_id}
  	</select>
  	<select id="adminToCharDate" parameterType="String" resultType="zipcok.admin.model.PyoAdDTO">
  		select to_char(coach_joindate,'yyyy-mm-dd') as joindate, to_char(coach_change,'yyyy-mm-dd') as change 
  		from 
  		coach_regist
  		 where
  		  coach_mem_id = #{value}
  	</select>
  	
  	<update id="adminCoachIntroUpdate" parameterType="HashMap">
  		update coach_regist set
  		coach_intro_sub=#{coach_intro_sub},
  		coach_intro_cont=#{coach_intro_cont}
  		where
  		coach_mem_id = #{coach_mem_id}
  	</update>
  	<update id="adminCoachMatUpdate" parameterType="HashMap">
  		update coach_regist set
  		coach_mat=#{coach_mat}
  		where
  		coach_mem_id = #{coach_mem_id}
  	</update>
  	<update id="adminCoachExtypeUpdate" parameterType="HashMap">
  		update coach_regist set
  		coach_ex_type=#{coach_ex_type}
  		where
  		coach_mem_id = #{coach_mem_id}
  	</update>
  	<update id="adminCoachYearUpdate" parameterType="HashMap">
  		update coach_regist set
  		coach_year=#{coach_year}
  		where
  		coach_mem_id = #{coach_mem_id}
  	</update>
  	<update id="adminCoachFlocUpdate" parameterType="HashMap">
  		update coach_regist set
  		coach_floc=#{coach_floc},
  		coach_sloc=#{coach_sloc}
  		where
  		coach_mem_id = #{coach_mem_id}
  	</update>
  	<!-- 코치 정보 관리 끝-->
  	
  	<!-- 취소 환불 관리 시작-->
  	<select id="canTotalCnt" parameterType="HashMap" resultType="Integer">
  		select count(*) 
  		from
  		zipcok_payment_details
  		where
  		pd_key='코치'
  		<choose>
	  		<when test="cancelSelect=='전체'"></when>
	  		<when test="cancelSelect=='취소요청중'">and pd_status=#{cancelSelect}</when>
	  		<when test="cancelSelect=='결제취소완료'">and pd_status=#{cancelSelect}</when>
	  		<when test="cancelSelect=='결제완료'">and pd_status=#{cancelSelect}</when>
  		</choose>
  	</select>
  	<select id="adminCoachCancelAllList" parameterType="HashMap" resultType="zipcok.admin.model.AdminPaymentDetailsDTO">
  		select * from (select rownum as rnum,a.* from (select * from zipcok_payment_details
  		where
  		pd_key='코치'
  		<choose>
	  		<when test="cancelSelect=='전체'"></when>
	  		<when test="cancelSelect=='취소요청중'">and pd_status=#{cancelSelect}</when>
	  		<when test="cancelSelect=='결제취소완료'">and pd_status=#{cancelSelect}</when>
	  		<when test="cancelSelect=='결제완료'">and pd_status=#{cancelSelect}</when>
  		</choose>
  		order by pd_idx)a)b
  		where
	  	rnum between #{start} and #{end}
  	</select>

  	<select id="canSearchTotalCnt" parameterType="HashMap" resultType="Integer">
  		select count(*) from (select * from zipcok_payment_details
  		where
  		pd_key='코치'
  		<choose>
		  	<when test="searchCon=='코치아이디'">
		  		<choose>
			  		<when test="searchT==''">and pd_target_id like '%%'</when>
			  		<when test="searchT!=''">and pd_target_id = #{searchT}</when>
		  		</choose>
		  	</when>
		  	<when test="searchCon=='회원아이디'">
		  		<choose>
			  		<when test="searchT==''">and pd_mem_id like '%%'</when>
			  		<when test="searchT!=''">and pd_mem_id=#{searchT}</when>
		  		</choose>
		  	</when>
     	</choose>
     	)
  	</select>
  	<select id="adminCoachCancleSearchPd" parameterType="HashMap" resultType="zipcok.admin.model.AdminPaymentDetailsDTO">
  		select * from (select rownum as rnum,a.* from(select * from zipcok_payment_details
  		where
  		pd_key='코치'
  		<choose>
		  	<when test="searchCon=='코치아이디'">
		  		<choose>
			  		<when test="searchT==''">and pd_target_id like '%%'</when>
			  		<when test="searchT!=''">and pd_target_id = #{searchT}</when>
		  		</choose>
		  	</when>
		  	<when test="searchCon=='회원아이디'">
		  		<choose>
			  		<when test="searchT==''">and pd_mem_id like '%%'</when>
			  		<when test="searchT!=''">and pd_mem_id=#{searchT}</when>
		  		</choose>
		  	</when>
     	</choose>
     	order by pd_idx)a)b
  		where
	  	rnum between #{start} and #{end}
  	</select>
  	
  	<update id="updateStatus" parameterType="Integer">
  		update zipcok_payment_details
  		set
  		pd_status='결제취소완료'
  		where
  		pd_idx=#{pd_idx}
  	</update>
  	<!-- 취소 환불 관리 끝-->
  </mapper>