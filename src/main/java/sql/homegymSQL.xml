<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="zipcok.homegym">
	<insert id="hgAddSQL"
		parameterType="zipcok.homegym.model.HomeGymDTO">
		insert into homegym values(
		#{hg_mem_id}, #{hg_nickname},
		#{hg_person_count}, #{hg_price},
		#{hg_info}, '1', #{hg_faddr},
		#{hg_saddr}, #{hg_station}, #{hg_comeinfo},
		to_date(#{hg_start_date},'yyyy-mm-dd'),
		to_date(#{hg_end_date},'yyyy-mm-dd'),
		#{hg_not_date},
		#{hg_start_time},
		#{hg_end_time},
		sysdate, sysdate, '1')
	</insert>
	<insert id="hgEqAddSQL"
		parameterType="zipcok.homegym.model.HomeGymEquipmentDTO">
		insert into homegym_equipment values(
		eq_idx.nextval,
		#{eq_mem_id}, #{eq_name}, #{eq_count})
	</insert>
	<insert id="hgImgAddSQL"
		parameterType="zipcok.coach.model.CoachFileDTO">
		insert into
		member_file
		values(
		member_file_mfile_idx.nextval,
		#{mfile_key},
		#{mfile_mem_id},
		#{mfile_upload},
		#{mfile_size},
		#{mfile_orig},
		#{mfile_path},
		#{mfile_type}
		)
	</insert>

	<select id="hgNickNameCheckSQL" parameterType="String"
		resultType="String">
		select hg_nickname from homegym where hg_nickname =
		#{hg_nickname}
	</select>

	<select id="hgAvgPriceSQL" resultType="Integer">
		select avg(hg_price) from
		homegym
	</select>

	<select id="hgListSQL" parameterType="hashMap"
		resultType="zipcok.homegym.model.HomeGymDTO">
		select * from
		(select rownum as rnum, f.*, a.hg_eq from
		(select h.hg_mem_id, wm_concat(eq_name) as hg_eq from homegym
		h,homegym_equipment e
		where
		h.hg_mem_id = e.eq_mem_id
		group by
		h.hg_mem_id) a, homegym f
		where
		a.hg_mem_id = f.hg_mem_id
		and
		<choose>
			<when test = "location =='전체'"></when>
			<when test = "location !='전체'">
			f.hg_faddr like '%${location}%'
			and
			</when>
		</choose>
		<choose>
			<when test="choice_date == '1900-01-01'"></when>
			<when test="choice_date != '1900-01-01'">
				f.hg_start_date <![CDATA[<=]]>
				'${choice_date_d}'
				and
				f.hg_end_date <![CDATA[>=]]>
				'${choice_date_d}'
				and
			</when>
		</choose>
		f.hg_price <![CDATA[>=]]> #{price}
		and
		f.hg_person_count <![CDATA[>=]]> #{person_count}
		and
		f.hg_approved_check = '1'
		and
		f.hg_status = '1') b
		where
		rnum between #{start} and #{end}
	</select>
	<select id="userEquipmentListSQL" parameterType="String" resultType = "zipcok.homegym.model.HomeGymEquipmentDTO">
	select * from homegym_equipment where eq_mem_id = #{value} order by eq_name
	</select>
	<select id = "hgContentSQL" parameterType="String" resultType="zipcok.homegym.model.HomeGymDTO">
	select * from homegym where hg_mem_id = #{value}
	</select>
	<select id = "hgEquipmentContentSQL" parameterType="String" resultType="zipcok.homegym.model.HomeGymEquipmentDTO">
	select * from homegym_equipment where eq_mem_id = #{value}
	</select>
	<select id = "hgImageContentSQL" parameterType="String" resultType="zipcok.coach.model.CoachFileDTO">
		select * from member_file where mfile_key = '홈짐' and mfile_mem_id = #{value}
	</select>
	<select id = "homegymReviewSelectSQL" parameterType="String" resultType="zipcok.coach.model.ReviewDTO">
	select * from star_review where rev_key = '회원이홈짐' and rev_target_id = #{value} order by rev_writedate
	</select>
	<select id="homegymCheckSQL" parameterType="String" resultType="Integer">
	select count(*) from homegym where hg_mem_id = #{value}
	</select>
	<insert id = "PaymenAddSQL" parameterType="zipcok.homegym.model.PaymentDTO">
	insert into zipcok_payment values(
	pa_idx.nextval,
	#{hg_mem_id},
	'홈짐',
	#{pa_bankname},
	#{pa_no},
	#{pa_username}
	)
	</insert>
	<insert id = "hgReservationAddSQL" parameterType="zipcok.homegym.model.HomeGymReservationDTO">
	insert into homegym_reservation values(
	homegym_reservation_reser_idx.nextval,
	#{mem_id},
	#{hg_mem_id},
	#{reser_date},
	#{reser_start_time},
	#{reser_end_time},
	#{reser_person_count},
	sysdate,
	'예약됨',
	#{reser_price}
	)
	</insert>
	<select id = "hgReservationMaxIdxFindSQL" resultType = "Integer">
	select max(reser_idx) from homegym_reservation
	</select>
	<select id = "hgReservationSelectSQL" parameterType="Integer" resultType="zipcok.homegym.model.HomeGymReservationDTO">
	select * from homegym_reservation where reser_idx = #{value}
	</select>
	<insert id="PaymentListAddSQL" parameterType="zipcok.homegym.model.Payment_detailsDTO">
		insert into zipcok_payment_details values(
		zipcok_payment_details_pd_idx.nextval,
		#{pd_req_idx},
		'홈짐',
		#{pd_code},
		#{pd_target_id},
		#{pd_mem_id},
		#{pd_method},
		sysdate,
		'결제됨',
		#{pd_price}
		)
	</insert>
</mapper>